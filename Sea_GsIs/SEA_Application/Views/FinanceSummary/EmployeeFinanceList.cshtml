
@{
    Layout = "~/Views/Shared/_AccountHeadDashboardLayout.cshtml";
}
<style>
    #StudentTestList a:hover {
        text-decoration: underline;
    }

    #datatable_filter {
        display: block !important;
    }
</style>

<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Select Payment Type</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>



            </div>
            <div class="modal-body" id="ModelBody">
                @*<p>Some text in the modal.</p>*@

                Paid Date <input type="date" name="PaidDate" id="PaidDate" value="" /><br>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" id="SaveChallanForm" class="btn btn-primary">Save</button>
            </div>
        </div>

    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="card">


            <div class="card-body p-4">
                <div class="tab-content" style="padding: 10px 0px 0px 0px;">

                    <div class="tab-pane active show" id="Topics-attr" role="tabpanel" aria-labelledby="Topics-tab-attr">
                        <div class="box box-primary">
                            <div class="box-body">
                                <div class="box-title"></div>
                                <div class="table-responsive">
                                    <table class="table hover  table-striped table-bordered" id="datatable">
                                        <thead>
                                            <tr>
                                                <th>
                                                    Employee Name
                                                </th>
                                                <th>
                                                    Bank/Chq
                                                </th>
                                                <th>
                                                    Date
                                                </th>
                                                <th>
                                                    Fee Payable
                                                </th>
                                                <th>
                                                    Status
                                                </th>
                                                <th>
                                                    Action
                                                </th>

                                            </tr>

                                        </thead>

                                        <tbody id="EmployeeFinanceList">
                                        </tbody>


                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>




<script>

    var isPending = "";
    var isPaid = "";
    var Counter = 0;

    var SelectedMonths = [];

    var Status = [];


    $(document).ready(function () {

        GetAllBankCashLedger();

        $("#SaveChallanForm").click(function () {


            SaveChallanForm();

        })


        $("#PageHeader").html(" Employee Finances ");

        $("#BreadCrumbs").append(' <li> <a href="/AdmissionDashboard/Dashboard"> Home </a> <span>&gt;</span></li>');
        $("#BreadCrumbs").append(' <li class="active"><a id="BreadCrumps1" href="#">Employee Finances</a></li>');


        var table = $('#datatable').dataTable({
            buttons: [
                {
                    text: '<span class="datatableButtonsReset"> <img src="/Content/assets/assets/icons/Icon-Reset2.png" alt=""> Reset</span>'
                },
                {
                    text: '<span class="datatableButtonsEdit"> <img src="/Content/assets/assets/icons/Icon-edit.png" alt=""> Create</span>',
                    action: function (e, dt, button, config) {
                        window.location.href = '/FinanceSummary/CreateEmployeeFinance';
                    }
                },
                {
                    text: '<button onclick="ChangeStatusChallan()" value="Paid" class="btn btn-default"><i class="fa fa-calendar"> </i> Paid</button>'
                }
            ],
            "language": {
                "lengthMenu": "<div class=\"d-flex showEntriesCon\">\n" +
                    "  <div class=\"p-2\">Show </div> <div class=\"showEntries\"> _MENU_\n" +
                    "  </div>\n" +
                    "  </div>",
                "info": "<div class='showingEntriesOfTotal'>Showing <span class=\"text-info\">_START_ to _END_</span> of _TOTAL_ entries</div>",
                "paginate": {
                    "first": "Firstt",
                    "last": "Lastt",
                    "next": ' <img src="~/Content/assets/assets/icons/Arrow2.png" alt=""> ',
                    "previous": ' <img src="~/Content/assets/assets/icons/Arrow1.png" alt=""> '
                }
            },
            "searching": true,
            // dom: '<"class">Blfrtip',
            dom: "<'row mb-3'<'col-sm-12 col-md-2 col-lg-2'l><'col-sm-12 col-md-10 col-lg-10 datatableButtonsCon text-right'Bf>>" +
                "<'row'<'col-sm-12 datatablesData'tr>>" +
                "<'row mt-4'<'col-sm-12 col-md-4 col-lg-6 infoCon'i><'col-sm-12 col-md-8 col-lg-6 pagCon'p>>",
        });


        $(document).on("click", ".check_class", function () {
            debugger


            debugger;
            var ischecked = $(this).is(':checked');
            if (!ischecked) {
                var selectedvalue = $(this).val();
                var index = SelectedMonths.indexOf(selectedvalue);
                SelectedMonths.splice(index, 1);
                Status.splice(index, 1);

               // alert(SelectedMonths);
            }
            else {
                var selectedvalue = $(this).val();
                SelectedMonths.push(selectedvalue);
                Counter++;
                $("#counter").val(SelectedMonths);
                var statusName = $(this).attr('name')
                Status.push(statusName);

              //  alert(SelectedMonths);

            }


        });


//        $("#datatable1_filter").hide();

        //$('#datatable').on('click', 'tbody tr', function () {
        //    var td = $(this).children("td");
        //    var userName = $(td[0]).children("input").val(); //EditStudentReg

        //    window.location.href = "/AdmissionDashboard/EditStudentReg?id=" + userName;
        //});



        $.ajax({
            type: "POST",
            url: "/FinanceSummary/EmployeeFinances",
            data: {},

            success: function (data) {
                table.fnClearTable();
                $.each(data, function (index) {

                    var value1 = new Date(parseInt(data[index].DueDate.replace(/(^.*\()|([+-].*$)/g, '')));
                    var dat1 = value1.getMonth() +
                        1 +
                        "/" +
                        value1.getDate() +
                        "/" +
                        value1.getFullYear();// + " " +
                        // value.getTime().toString();


                    table.fnAddData([data[index].Name + "<input class='check_class'  type=hidden value=" + data[index].Id + ">", data[index].Bank_Chq, dat1, data[index].Total_SalaryPayable, data[index].Status, "<input type='checkbox' value=" + data[index].Id + " class='check_class' name=" + data[index].Status + "  id="+data[index].Id+" /><label for="+data[index].Id+"></label>"]);

                })
                table.fnDraw();

            }
        })

    })//end of document ready

    function ChangeStatusChallan() {


        var StdId = SelectedMonths.toString();
        if (StdId == "") {

          //  $("#Error_Text").html("");

        }

        else {
            debugger
            isPaid = "";
            isPending = "";
            for (var a = 0; a < Status.length; a++) {

                if (Status[a] == "Paid") {

                    isPaid = "Paid";
                    break;
                }
                //else if (Status[a] == "Pending") {
                //    isPending = "Pending";
                //    break;
                //}
                else {

                }
            }
            if (isPaid == "Paid") {

                var type = 'danger';
                var msg = "Salary is already paid";
                showNotification('top', 'center', msg, type);

            }
            //else if (isPending == "Pending") {

            //    var type = 'danger';
            //    var msg = "Pending challan cannot be paid";
            //    showNotification('top', 'center', msg, type);

            //}
            else {

                $('input[name="payment"]').prop("checked", false);
                $('#myModal').modal('show');
                $("#SaveChallanForm").attr("disabled", false);
                $("#Error").html("");


            
            }
        }

    }
    function GetAllBankCashLedger() {

        var today = new Date();

        document.getElementById("PaidDate").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);

        $.ajax({
            type: "POST",
            url: "/StudentFeeMonths/GetAllBankCashLedgers",
            success: function (data) {

                debugger
                $.each(data, function (i, item) {

                    $("#ModelBody").append('<br><input value  ="' + item.Id + '" type="radio" name ="payment" id="' + item.Id + '" >' + item.Name + ' ');


                })

                $("#ModelBody").append('<br><span style="color:red" id ="Error"></span>');

            }

        })

    }
    function SaveChallanForm() {

        var StdId = SelectedMonths.toString();

        if ($("input:radio[name='payment']").is(":checked")) {

            var LedgerId = $("input[name='payment']:checked").val();
            var PaidDate = $("#PaidDate").val();

            $("#SaveChallanForm").attr("disabled", true);

            //(string idlist, int LedgerId, string PaidDate)
            window.location.href = "/FinanceSummary/PaySalary?idlist=" + StdId + "&LedgerId=" + LedgerId + "&PaidDate=" + PaidDate;


        }
        else {
            $("#Error").html("Please Select Payment Type ");

        }


    }

</script>



